# PBD Tools - AutoCAD LISP 자동화 도구

AutoCAD에서 구역 좌표 내보내기 및 홀 코드 자동 생성을 위한 AutoLISP 도구 모음입니다.

## 파일 구성

| 파일명 | 설명 |
|--------|------|
| `구역좌표 내보내기.LSP` | 폴리라인 구역 좌표를 Excel로 내보내는 도구 |
| `홀코드 260205.lsp` | 다이얼로그 기반 홀 코드 자동 생성 도구 |
| `PBD_Tools.odcl` | OpenDCL 다이얼로그 UI 정의 파일 |

## 요구사항

- **AutoCAD** (AutoLISP 지원 버전)
- **OpenDCL** 플러그인 (홀코드 도구의 UI에 필요)
- **Microsoft Excel** (좌표 내보내기 시 필요)

---

## 1. 구역좌표 내보내기 (`구역좌표 내보내기.LSP`)

### 명령어: `RCT`

AutoCAD 도면의 **노란색(색상 2) LWPOLYLINE** 객체에서 꼭짓점 좌표를 추출하여 Excel 시트에 자동으로 입력합니다.

### 사용 방법

1. Excel을 미리 열어둡니다.
2. AutoCAD 명령줄에 `RCT`를 입력합니다.
3. 노란색 폴리라인 객체를 선택합니다.
4. Excel에서 데이터를 입력할 시작 셀을 지정합니다.
5. 각 폴리라인마다 해당 구역의 텍스트 코드를 클릭하여 지정합니다.

### Excel 출력 형식

| 열 | 내용 |
|----|------|
| 1열 | 꼭짓점 순번 |
| 2열 | Y 좌표 |
| 3열 | X 좌표 |
| 4열 | 구역 코드 (텍스트) |

### 주요 함수

- **`c:rct`** - 메인 실행 함수. 폴리라인 선택, Excel 연동, 좌표 추출을 수행합니다.
- **`get_ent_pro`** - 엔티티의 꼭짓점 좌표 리스트를 추출합니다. DXF 그룹 코드 10(꼭짓점 좌표)을 순회하며 좌표 목록을 반환합니다.
- **`fun:odputrowvalue`** - 값 리스트를 Excel 셀에 순차적으로 기록합니다. COM 인터페이스(`vlax-put-property`)를 사용합니다.

### 처리 흐름

```
폴리라인 선택 → Excel 셀 범위 지정 → 각 폴리라인 순회
  → 구역 코드 텍스트 클릭 선택
  → 꼭짓점 좌표 추출 (vlax-curve-getpointatparam)
  → 순번/Y좌표/X좌표/코드를 Excel에 기록
  → 닫힌 폴리라인인 경우 시작점 좌표를 마지막에 추가
  → 처리 완료 후 폴리라인 색상을 초록색(3)으로 변경 (완료 표시)
```

---

## 2. 홀 코드 자동 생성 (`홀코드 260205.lsp`)

### 명령어: `PBD`

OpenDCL 다이얼로그를 통해 원(Circle) 객체를 선택하고, 행/열 기준으로 정렬하여 자동으로 홀 코드 텍스트를 생성합니다.

### 사용 방법

1. AutoCAD 명령줄에 `PBD`를 입력하면 다이얼로그가 열립니다.
2. 다이얼로그에서 다음 항목을 설정합니다:
   - **구역**: 구역명 텍스트를 도면에서 클릭하여 지정
   - **깊이**: 깊이 텍스트를 클릭하여 지정
   - **간격**: 간격 텍스트를 클릭하여 지정
   - **세로 번호**: 시작 번호 또는 알파벳 선택 (예: `1`, `A`)
   - **가로 번호**: 시작 알파벳 또는 번호 선택 (예: `A`, `1`)
3. **선택** 버튼을 클릭하여 도면에서 원(Circle) 객체를 선택합니다.
4. 자동으로 코드가 생성되어 각 원 위치에 텍스트가 배치됩니다.

### 생성되는 코드 형식

```
[세로번호]-[가로번호]
예: 001-00A, 001-00B, 002-00A, 002-00B ...
```

### 주요 함수

- **`c:PBD`** - 메인 함수. OpenDCL 다이얼로그를 로드하고 표시합니다.
- **`c:select#OnClicked`** - 선택 버튼 이벤트 핸들러. 원 객체 선택 후 정렬 및 코드 생성을 실행합니다.
- **`subTextSort`** - 객체를 **세로(Y축) 기준**으로 그룹화한 뒤 정렬합니다. 같은 행에 있는 객체를 텍스트 높이(`tH`) 범위 내에서 묶습니다.
- **`subTextSort2`** - 객체를 **가로(X축) 기준**으로 그룹화한 뒤 정렬합니다.
- **`TextMake`** - 지정된 좌표에 텍스트 엔티티를 생성합니다 (높이 0.3, 노란색, 지정 레이어).
- **`three_text`** - 숫자를 3자리 문자열로 변환합니다 (`1` → `001`, `12` → `012`).
- **`LM:A++`** - 알파벳 증가 함수. `A` → `B`, `Z` → `AA` 형태로 자동 증가합니다.
- **`c:export#OnClicked`** - 내보내기 버튼 이벤트 핸들러. 생성된 텍스트(높이 0.3)를 선택하여 레이어/코드/좌표를 Excel로 내보냅니다.

### 정렬 로직

```
원(Circle) 선택 → Y좌표 기준 행 그룹화 (subTextSort)
                → X좌표 기준 열 그룹화 (subTextSort2)
                → 행 번호 + 열 번호 조합하여 코드 생성
                → 각 원 위치에 텍스트 배치
```

---

## 설치 방법

1. 모든 파일을 같은 폴더에 배치합니다.
2. AutoCAD에서 `APPLOAD` 명령으로 `.lsp` 파일을 로드합니다.
3. `PBD_Tools.odcl` 파일은 홀코드 도구 실행 시 자동으로 로드됩니다.

## 라이선스

이 프로젝트는 개인/업무용으로 제작된 AutoCAD 자동화 도구입니다.
